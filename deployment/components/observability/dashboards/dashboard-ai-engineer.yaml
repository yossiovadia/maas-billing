apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: ai-engineer-dashboard
spec:
  instanceSelector:
    matchLabels:
      app: grafana
  folder: MaaS v1.0
  json: |
    {
      "annotations": {
        "list": [
          {"builtIn": 1, "datasource": {"type": "grafana", "uid": "-- Grafana --"}, "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard"}
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "panels": [
        {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0}, "id": 100, "panels": [], "title": "üìä My Usage Summary", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 5, "w": 4, "x": 0, "y": 1},
          "id": 1,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(authorized_hits{user=~\"^$user$\"})", "instant": true, "refId": "A"}],
          "description": "Total API tokens you have consumed that were successfully authorized.",
          "title": "üìä Total Tokens",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "blue", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 5, "w": 4, "x": 4, "y": 1},
          "id": 11,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(authorized_calls{user=~\"^$user$\"})", "instant": true, "refId": "A"}],
          "description": "Total API requests you have made that were successfully authorized.",
          "title": "üìä Total Requests",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}, "overrides": []},
          "gridPos": {"h": 5, "w": 4, "x": 8, "y": 1},
          "id": 2,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(rate(authorized_hits{user=~\"^$user$\"}[5m]))", "instant": true, "refId": "A"}],
          "description": "Your current token consumption rate (tokens per second) averaged over the last 5 minutes.",
          "title": "‚ö° Token Rate",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "blue", "value": null}]}, "unit": "reqps"}, "overrides": []},
          "gridPos": {"h": 5, "w": 4, "x": 12, "y": 1},
          "id": 12,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(rate(authorized_calls{user=~\"^$user$\"}[5m]))", "instant": true, "refId": "A"}],
          "description": "Your current request rate (requests per second) averaged over the last 5 minutes.",
          "title": "‚ö° Request Rate",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 0.1}, {"color": "red", "value": 0.3}]}, "unit": "percentunit"}, "overrides": []},
          "gridPos": {"h": 5, "w": 4, "x": 16, "y": 1},
          "id": 3,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "(sum(limited_calls{user=~\"^$user$\"}) / (sum(authorized_calls{user=~\"^$user$\"}) + sum(limited_calls{user=~\"^$user$\"}))) OR vector(0)", "instant": true, "refId": "A"}],
          "description": "Percentage of your requests rejected by rate limiting (HTTP 429). High values indicate you are exceeding your tier quota ‚Äî consider upgrading your tier or reducing request frequency.",
          "title": "üö¶ Rate Limit Ratio",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "yellow", "value": 0.9}, {"color": "green", "value": 0.95}]}, "unit": "percentunit"}, "overrides": []},
          "gridPos": {"h": 5, "w": 4, "x": 20, "y": 1},
          "id": 8,
          "options": {"orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "showThresholdLabels": false, "showThresholdMarkers": true, "text": {}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "((sum(rate(vllm:request_success_total[5m])) / sum(rate(vllm:e2e_request_latency_seconds_count[5m]))) >= 0) OR vector(1)", "instant": true, "refId": "A"}],
          "description": "Model inference success rate: percentage of requests that reached the model and completed successfully. This is a platform-wide health indicator (vLLM metrics do not carry per-user labels).",
          "title": "‚úÖ Inference Success Rate",
          "type": "gauge"
        },
        {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 6}, "id": 101, "panels": [], "title": "üìà Usage Trends", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Requests", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 7},
          "id": 4,
          "options": {"legend": {"calcs": ["lastNotNull", "mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (model) (authorized_hits{user=~\"^$user$\", model!=\"\"})", "legendFormat": "{{model}}", "refId": "A"}],
          "description": "Your token consumption broken down by model. Shows which models consume the most tokens.",
          "title": "üìà Token Usage by Model",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Requests per Second", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}, "overrides": [{"matcher": {"id": "byName", "options": "Rate Limited"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]}]},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 7},
          "id": 5,
          "options": {"legend": {"calcs": ["lastNotNull", "mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(rate(authorized_hits{user=~\"^$user$\"}[5m]))", "legendFormat": "Tokens (authorized)", "refId": "A"}, {"expr": "sum(rate(limited_calls{user=~\"^$user$\"}[5m]))", "legendFormat": "Requests (rate limited)", "refId": "B"}],
          "description": "Token consumption rate (authorized) and rate-limited request rate over time. Use this to identify when you hit rate limits.",
          "title": "üìä Usage Trends (Tokens vs Rate Limited Requests)",
          "type": "timeseries"
        },
        {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 15}, "id": 102, "panels": [], "title": "‚è∞ Hourly Usage Patterns", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Tokens", "axisPlacement": "auto", "barAlignment": 0, "barWidthFactor": 0.8, "drawStyle": "bars", "fillOpacity": 80, "gradientMode": "hue", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "normal"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 16},
          "id": 9,
          "options": {"legend": {"calcs": ["sum", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (model) (increase(authorized_hits{user=~\"^$user$\", model!=\"\"}[1h]))", "legendFormat": "{{model}}", "refId": "A"}],
          "title": "‚è∞ Hourly Token Usage by Model",
          "type": "timeseries"
        },
        {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 24}, "id": 103, "panels": [], "title": "üîç Detailed Analysis", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "Total Tokens", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "bars", "fillOpacity": 80, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 25},
          "id": 6,
          "options": {"legend": {"calcs": ["lastNotNull", "sum"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (model) (increase(authorized_hits{user=~\"^$user$\", model!=\"\"}[$__range]))", "legendFormat": "{{model}}", "refId": "A"}],
          "title": "üìä Token Volume by Model (Selected Range)",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 33},
          "id": 10,
          "options": {"legend": {"calcs": ["lastNotNull", "sum"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (tier) (increase(limited_calls{user=~\"^$user$\", tier!=\"\"}[$__range]))", "legendFormat": "{{tier}} (limited)", "refId": "A"}],
          "title": "‚ùå Rate Limited by Tier (Selected Range)",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"custom": {"align": "auto", "cellOptions": {"type": "auto"}, "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": [{"matcher": {"id": "byName", "options": "model"}, "properties": [{"id": "displayName", "value": "ü§ñ Model"}]}, {"matcher": {"id": "byName", "options": "tier"}, "properties": [{"id": "displayName", "value": "üè∑Ô∏è Tier"}]}, {"matcher": {"id": "byName", "options": "Value"}, "properties": [{"id": "displayName", "value": "üìä Hits"}]}]},
          "gridPos": {"h": 6, "w": 24, "x": 0, "y": 41},
          "id": 7,
          "options": {"cellHeight": "sm", "footer": {"countRows": false, "fields": "", "reducer": ["sum"], "show": true}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "üìä Hits"}]},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (model, tier) (authorized_hits{user=~\"^$user$\", model!=\"\"})", "format": "table", "instant": true, "refId": "A"}],
          "title": "üîç My Usage Summary by Model & Tier",
          "type": "table"
        }
      ],
      "refresh": "30s",
      "schemaVersion": 40,
      "tags": ["maas", "ai-engineer", "observability"],
      "templating": {
        "list": [
          {"current": {"selected": true, "text": "prometheus", "value": "prometheus"}, "hide": 0, "includeAll": false, "label": "Datasource", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "type": "datasource"},
          {"allValue": ".*", "current": {"selected": true, "text": "All", "value": "$__all"}, "datasource": {"type": "prometheus", "uid": "${datasource}"}, "definition": "label_values(authorized_hits, user)", "hide": 0, "includeAll": true, "label": "API Key / User", "multi": false, "name": "user", "options": [], "query": {"query": "label_values(authorized_hits, user)", "refId": "StandardVariableQuery"}, "refresh": 1, "regex": "", "skipUrlSync": false, "sort": 1, "type": "query"}
        ]
      },
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "",
      "title": "üî∑ AI Engineer Dashboard",
      "uid": "ai-engineer",
      "version": 1,
      "weekStart": ""
    }

