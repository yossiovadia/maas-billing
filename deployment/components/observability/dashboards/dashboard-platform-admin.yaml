apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: platform-admin-dashboard
spec:
  instanceSelector:
    matchLabels:
      app: grafana
  folder: MaaS v1.0
  json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "grafana",
              "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "panels": [
        {
          "collapsed": false,
          "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0},
          "id": 100,
          "panels": [],
          "title": "üè• Component Health",
          "type": "row"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]},
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {"h": 4, "w": 6, "x": 0, "y": 1},
          "id": 10,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "max(limitador_up)", "instant": true, "refId": "A"}],
          "description": "Shows if Limitador (rate limiting service) is running. Green = healthy, Red = down. Uses max() to deduplicate across scrape sources (PodMonitor + headless service auto-discovery).",
          "title": "üíö Limitador",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]},
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {"h": 4, "w": 6, "x": 6, "y": 1},
          "id": 11,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "count(kube_pod_status_phase{namespace=~\"$kuadrant_namespace\", pod=~\"authorino.*\", phase=\"Running\"}) OR vector(0)", "instant": true, "refId": "A"}],
          "description": "Count of running Authorino pods (authentication/authorization service). Should be >= 1.",
          "title": "üîê Authorino",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]},
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {"h": 4, "w": 6, "x": 12, "y": 1},
          "id": 12,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "count(kube_pod_status_phase{namespace=~\"$maas_namespace\", pod=~\"maas-api.*\", phase=\"Running\"} == 1) OR on() vector(0)", "instant": true, "refId": "A"}],
          "description": "Count of running MaaS API pods. These handle token generation and model routing.",
          "title": "üåê MaaS API Pods",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]},
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {"h": 4, "w": 6, "x": 18, "y": 1},
          "id": 13,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "count(kube_pod_status_phase{namespace=~\"$gateway_namespace\", pod=~\"maas-default-gateway.*\", phase=\"Running\"} == 1) OR on() vector(0)", "instant": true, "refId": "A"}],
          "description": "Count of running Istio Gateway pods. These are the entry point for all API traffic.",
          "title": "üö™ Gateway Pods",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "mappings": [{"options": {"0": {"color": "green", "index": 0, "text": "No Alerts"}}, "type": "value"}],
              "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}, {"color": "red", "value": 3}]},
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {"h": 6, "w": 6, "x": 0, "y": 5},
          "id": 200,
          "options": {"colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "count(ALERTS{alertstate=\"firing\", alertname!=\"Watchdog\", namespace=~\"$llm_namespace|$kuadrant_namespace|$maas_namespace|envoy-gateway-system\"}) OR vector(0)", "instant": true, "refId": "A"}],
          "description": "Number of currently firing Prometheus alerts for MaaS components. 0 = healthy.",
          "title": "üö® Firing Alerts",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "custom": {"align": "auto", "cellOptions": {"type": "auto"}, "inspect": false},
              "mappings": [],
              "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]},
              "noValue": "‚úÖ No active alerts"
            },
            "overrides": [
              {"matcher": {"id": "byName", "options": "alertname"}, "properties": [{"id": "displayName", "value": "Alert"}]},
              {"matcher": {"id": "byName", "options": "severity"}, "properties": [{"id": "displayName", "value": "Severity"}]},
              {"matcher": {"id": "byName", "options": "namespace"}, "properties": [{"id": "displayName", "value": "Namespace"}]}
            ]
          },
          "gridPos": {"h": 6, "w": 18, "x": 6, "y": 5},
          "id": 201,
          "options": {"cellHeight": "sm", "footer": {"countRows": false, "fields": "", "reducer": ["sum"], "show": false}, "showHeader": true},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "ALERTS{alertstate=\"firing\", alertname!=\"Watchdog\", namespace=~\"$llm_namespace|$kuadrant_namespace|$maas_namespace|envoy-gateway-system\"}", "format": "table", "instant": true, "refId": "A"}],
          "description": "List of currently firing Prometheus alerts for MaaS-related namespaces. Excludes the 'Watchdog' heartbeat alert.",
          "title": "üìã Active Alerts",
          "transformations": [{"id": "organize", "options": {"excludeByName": {"Time": true, "Value": true, "__name__": true, "alertstate": true}, "indexByName": {"alertname": 0, "severity": 1, "namespace": 2}, "renameByName": {}}}],
          "type": "table"
        },
        {
          "collapsed": false,
          "gridPos": {"h": 1, "w": 24, "x": 0, "y": 22},
          "id": 110,
          "panels": [],
          "title": "üîê Auth Evaluation",
          "type": "row"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "Authentication/authorization evaluation latency (P50/P95/P99). Shows how long Authorino takes to evaluate each request. High latency here adds directly to overall request latency. Requires the authorino-server-metrics ServiceMonitor.",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 0.1}, {"color": "red", "value": 0.5}]}, "unit": "s", "noValue": "No Data\nDeploy authorino-server-metrics ServiceMonitor"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 23},
          "id": 52,
          "options": {"legend": {"calcs": ["lastNotNull", "mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "histogram_quantile(0.5, sum(rate(auth_server_authconfig_duration_seconds_bucket[5m])) by (le))", "legendFormat": "P50", "refId": "A"}, {"expr": "histogram_quantile(0.95, sum(rate(auth_server_authconfig_duration_seconds_bucket[5m])) by (le))", "legendFormat": "P95", "refId": "B"}, {"expr": "histogram_quantile(0.99, sum(rate(auth_server_authconfig_duration_seconds_bucket[5m])) by (le))", "legendFormat": "P99", "refId": "C"}],
          "title": "üîê Auth Evaluation Latency (P50/P95/P99)",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "Rate of auth evaluation outcomes from Authorino. Shows successful authentications vs denials over time. A rising denial rate may indicate misconfigured policies or an attack. Requires the authorino-server-metrics ServiceMonitor.",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops", "noValue": "No Data\nDeploy authorino-server-metrics ServiceMonitor"}, "overrides": [{"matcher": {"id": "byRegexp", "options": ".*OK.*"}, "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]}, {"matcher": {"id": "byRegexp", "options": ".*(PERMISSION_DENIED|UNAUTHENTICATED).*"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]}]},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 23},
          "id": 53,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (status) (rate(auth_server_authconfig_response_status[5m]))", "legendFormat": "{{status}}", "refId": "A"}],
          "title": "üîê Auth Success / Deny Rate",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {"h": 1, "w": 24, "x": 0, "y": 11},
          "id": 101,
          "panels": [],
          "title": "üìä Key Metrics",
          "type": "row"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 0, "y": 12},
          "id": 1,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(authorized_hits)", "instant": true, "refId": "A"}],
          "description": "Total tokens consumed by successful API requests.",
          "title": "üìä Total Tokens",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "blue", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 6, "y": 12},
          "id": 38,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(authorized_calls)", "instant": true, "refId": "A"}],
          "description": "Total API requests that were successfully authorized.",
          "title": "üìä Total Requests",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 12, "y": 12},
          "id": 3,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(rate(authorized_hits[5m]))", "instant": true, "refId": "A"}],
          "description": "Current token consumption rate (tokens per second) averaged over the last 5 minutes.",
          "title": "‚ö° Token Rate",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "blue", "value": null}]}, "unit": "reqps"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 18, "y": 12},
          "id": 39,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(rate(authorized_calls[5m]))", "instant": true, "refId": "A"}],
          "description": "Current request rate (requests per second) averaged over the last 5 minutes.",
          "title": "‚ö° Request Rate",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "yellow", "value": 0.9}, {"color": "green", "value": 0.95}]}, "unit": "percentunit"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 0, "y": 17},
          "id": 4,
          "options": {"orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "showThresholdLabels": false, "showThresholdMarkers": true, "text": {}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "((sum(rate(vllm:request_success_total[5m])) / sum(rate(vllm:e2e_request_latency_seconds_count[5m]))) >= 0) OR vector(1)", "instant": true, "refId": "A"}],
          "description": "Model inference success rate: requests that completed successfully / total requests that reached the model. Rate-limited requests (429) are excluded ‚Äî they never reach the model and are tracked separately in the Rate Limit Ratio panel.",
          "title": "‚úÖ Inference Success Rate",
          "type": "gauge"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 6, "y": 17},
          "id": 14,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "count(count by (user) (authorized_calls))", "instant": true, "refId": "A"}],
          "description": "Unique users with at least one successful request (aligns with maas_tier_active_users concept; platform total).",
          "title": "üë• Active Users",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 100}, {"color": "red", "value": 500}]}, "unit": "ms", "noValue": "No traffic in last 15m"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 12, "y": 17},
          "id": 17,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "histogram_quantile(0.5, sum(rate(istio_request_duration_milliseconds_bucket[15m])) by (le))", "instant": true, "refId": "A"}],
          "description": "Median (50th percentile) response latency measured at the gateway over a 15m window. 50% of requests complete faster than this value.",
          "title": "‚è±Ô∏è P50 Response Latency",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 0.1}, {"color": "red", "value": 0.3}]}, "unit": "percentunit"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 18, "y": 17},
          "id": 40,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "(sum(limited_calls) / (sum(authorized_calls) + sum(limited_calls))) OR vector(0)", "instant": true, "refId": "A"}],
          "description": "Percentage of gateway requests rejected by rate limiting (HTTP 429). High values indicate users are exceeding their tier quotas ‚Äî consider adjusting rate limits or upgrading user tiers. This is a capacity planning signal, not a system health issue.",
          "title": "üö¶ Rate Limit Ratio",
          "type": "stat"
        },
        {
          "collapsed": false,
          "gridPos": {"h": 1, "w": 24, "x": 0, "y": 31},
          "id": 102,
          "panels": [],
          "title": "üìà Traffic Analysis",
          "type": "row"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32},
          "id": 5,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (model) (rate(authorized_hits{model!=\"\"}[5m]))", "legendFormat": "{{model}}", "refId": "A"}],
          "description": "Token consumption rate (tokens/s) broken down by model. Shows which models consume the most tokens.",
          "title": "üìà Token Rate by Model",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]}, "unit": "ops"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32},
          "id": 6,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(rate(istio_requests_total{response_code=~\"4..\", response_code!=\"429\"}[5m])) OR vector(0)", "legendFormat": "4xx Errors (excl. 429)", "refId": "A"}, {"expr": "sum(rate(istio_requests_total{response_code=~\"5..\"}[5m])) OR vector(0)", "legendFormat": "5xx Errors", "refId": "B"}, {"expr": "sum(rate(limited_calls[5m])) OR vector(0)", "legendFormat": "429 Rate Limited", "refId": "C"}],
          "description": "Error rates by type. 4xx = client errors excluding 429 (401 auth, 400 bad request), 5xx = server errors, Rate Limited = 429 quota exceeded (from Limitador).",
          "title": "‚ùå Overall Error Rate",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 40},
          "id": 7,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (tier) (rate(authorized_hits[5m]))", "legendFormat": "{{tier}}", "refId": "A"}],
          "description": "Token consumption rate (tokens/s) by tier (aligns with Token Consumption by Tier; metric: authorized_hits).",
          "title": "üìä Token Consumption by Tier",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "reqps"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 40},
          "id": 19,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (tier) (rate(authorized_calls[5m]))", "legendFormat": "{{tier}}", "refId": "A"}],
          "description": "Request rate (req/s) by tier (aligns with Request Volume by Tier; metric: authorized_calls).",
          "title": "üìà Request Volume by Tier",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 100}, {"color": "red", "value": 500}]}, "unit": "ms"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 48},
          "id": 18,
          "options": {"legend": {"calcs": ["lastNotNull", "mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "histogram_quantile(0.95, sum by (destination_service_name, le) (rate(istio_request_duration_milliseconds_bucket{destination_service_name!=\"unknown\"}[5m])))", "legendFormat": "{{destination_service_name}}", "refId": "A"}],
          "description": "95th percentile latency per backend service. Excludes 'unknown' (404s to non-existent paths).",
          "title": "‚è±Ô∏è P95 Latency by Service",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]}, "unit": "ops"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 48},
          "id": 20,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (tier) (rate(limited_calls[5m]))", "legendFormat": "{{tier}}", "refId": "A"}],
          "description": "Rate limit violations (HTTP 429) by tier (aligns with Rate Limit Violations; metric: limited_calls).",
          "title": "üö´ Rate Limit Violations by Tier",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {"h": 1, "w": 24, "x": 0, "y": 56},
          "id": 105,
          "panels": [],
          "title": "‚ùå Error Breakdown",
          "type": "row"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]}, "unit": "ops"}, "overrides": [{"matcher": {"id": "byName", "options": "Rate Limited"}, "properties": [{"id": "color", "value": {"fixedColor": "orange", "mode": "fixed"}}]}]},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 57},
          "id": 15,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(rate(limited_calls[5m]))", "legendFormat": "Rate Limited", "refId": "A"}],
          "description": "Rate of requests that exceeded quota and received HTTP 429 (Too Many Requests). High values indicate users are hitting their rate limits.",
          "title": "üö´ Rate Limited Requests",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}]}, "unit": "ops"}, "overrides": [{"matcher": {"id": "byName", "options": "Unauthorized"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]}]},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 57},
          "id": 16,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(rate(istio_requests_total{response_code=\"401\"}[5m])) OR vector(0)", "legendFormat": "Unauthorized (401)", "refId": "A"}],
          "title": "üîí Unauthorized Requests",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {"h": 1, "w": 24, "x": 0, "y": 65},
          "id": 106,
          "panels": [],
          "title": "ü§ñ Model Metrics",
          "type": "row"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 5}, {"color": "red", "value": 10}]}, "unit": "short", "noValue": "No Data - Waiting for vLLM deployment"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 0, "y": 66},
          "id": 21,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(vllm:num_requests_running)", "instant": true, "refId": "A"}],
          "description": "Number of inference requests currently being processed by the model. High values indicate the model is busy.",
          "title": "üîÑ Requests Running",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 10}, {"color": "red", "value": 50}]}, "unit": "short", "noValue": "No Data - Waiting for vLLM deployment"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 6, "y": 66},
          "id": 22,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(vllm:num_requests_waiting)", "instant": true, "refId": "A"}],
          "description": "Number of inference requests waiting in queue. Growing queue indicates model is overloaded and needs scaling.",
          "title": "‚è≥ Requests Waiting",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 0.7}, {"color": "red", "value": 0.9}]}, "unit": "percentunit", "noValue": "No Data - Waiting for vLLM deployment"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 12, "y": 66},
          "id": 23,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "avg(vllm:kv_cache_usage_perc)", "instant": true, "refId": "A"}],
          "description": "Percentage of GPU KV-cache in use. High values (>90%) may cause request queuing. Consider increasing GPU memory or scaling replicas.",
          "title": "üíæ GPU Cache Usage",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "blue", "value": null}]}, "unit": "short", "noValue": "No Data - Generate traffic first"}, "overrides": []},
          "gridPos": {"h": 5, "w": 6, "x": 18, "y": 66},
          "id": 24,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(increase(vllm:e2e_request_latency_seconds_count{model_name=~\"$model\"}[$__range]))", "instant": true, "refId": "A"}],
          "description": "Total inference requests processed by the model in the selected time range.",
          "title": "üìä Total Requests",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short", "noValue": "No Data - Generate traffic first"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 71},
          "id": 25,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (model_name) (vllm:num_requests_running{model_name=~\"$model\"})", "legendFormat": "{{model_name}} running", "refId": "A"}, {"expr": "sum by (model_name) (vllm:num_requests_waiting{model_name=~\"$model\"})", "legendFormat": "{{model_name}} waiting", "refId": "B"}],
          "description": "Running and waiting requests per model over time. Consistently growing waiting queues indicate scaling is needed.",
          "title": "üìä Model Queue Depth",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "s", "noValue": "No Data - Generate traffic first"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 71},
          "id": 26,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "histogram_quantile(0.5, sum(rate(vllm:e2e_request_latency_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P50", "refId": "A"}, {"expr": "histogram_quantile(0.95, sum(rate(vllm:e2e_request_latency_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P95", "refId": "B"}, {"expr": "histogram_quantile(0.99, sum(rate(vllm:e2e_request_latency_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P99", "refId": "C"}],
          "description": "End-to-end model inference latency (P50/P95/P99). Measured from request received to response complete. Includes queue time + processing time.",
          "title": "‚è±Ô∏è Model Inference Latency",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short", "noValue": "No Data\nDeploy vLLM/llm-d"}, "overrides": []},
          "gridPos": {"h": 5, "w": 12, "x": 0, "y": 79},
          "id": 27,
          "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(increase(vllm:request_prompt_tokens_sum{model_name=~\"$model\"}[1h])) + sum(increase(vllm:request_generation_tokens_sum{model_name=~\"$model\"}[1h]))", "instant": true, "refId": "A"}],
          "title": "üî§ Tokens (1h)",
          "description": "Total prompt + generation tokens processed in the last hour across all models.",
          "type": "stat"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "tokens/s", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short", "noValue": "No Data\nDeploy vLLM/llm-d"}, "overrides": []},
          "gridPos": {"h": 5, "w": 12, "x": 12, "y": 79},
          "id": 28,
          "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum(rate(vllm:request_prompt_tokens_sum{model_name=~\"$model\"}[5m]))", "legendFormat": "Prompt tokens/s", "refId": "A"}, {"expr": "sum(rate(vllm:request_generation_tokens_sum{model_name=~\"$model\"}[5m]))", "legendFormat": "Generation tokens/s", "refId": "B"}],
          "description": "Token processing rate. Prompt = input tokens, Generation = output tokens. Higher is better for throughput.",
          "title": "üî§ Token Throughput",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "Ratio of prompt (input) tokens to total tokens per model. Values close to 1.0 mean users send large contexts with little generation; values close to 0 mean mostly output tokens. Helps identify prompt-heavy vs generation-heavy workloads for capacity planning.",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "prompt ratio", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "smooth", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "percentunit", "min": 0, "max": 1, "noValue": "No Data - Generate traffic first"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 84},
          "id": 50,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "(sum by (model_name) (rate(vllm:request_prompt_tokens_sum{model_name=~\"$model\"}[5m]))) / clamp_min(sum by (model_name) (rate(vllm:request_prompt_tokens_sum{model_name=~\"$model\"}[5m])) + sum by (model_name) (rate(vllm:request_generation_tokens_sum{model_name=~\"$model\"}[5m])), 1e-9) and (sum by (model_name) (rate(vllm:request_prompt_tokens_sum{model_name=~\"$model\"}[5m])) + sum by (model_name) (rate(vllm:request_generation_tokens_sum{model_name=~\"$model\"}[5m]))) > 0", "legendFormat": "{{model_name}}", "refId": "A"}],
          "title": "üìä Prompt vs Generation Token Ratio",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "Time requests spend waiting in the model's queue before processing begins (P50/P95/P99). Rising queue wait times are a critical signal that the model needs scaling. Requires vLLM or llm-d serving backend with queue metrics enabled.",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 1}, {"color": "red", "value": 5}]}, "unit": "s", "noValue": "No Data ‚Äî requires vLLM/llm-d backend"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 84},
          "id": 51,
          "options": {"legend": {"calcs": ["lastNotNull", "mean", "max"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "histogram_quantile(0.5, sum(rate(vllm:request_queue_time_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P50", "refId": "A"}, {"expr": "histogram_quantile(0.95, sum(rate(vllm:request_queue_time_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P95", "refId": "B"}, {"expr": "histogram_quantile(0.99, sum(rate(vllm:request_queue_time_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P99", "refId": "C"}],
          "title": "‚è≥ Queue Wait Time",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "Time to First Token (TTFT) over time. Shows P50, P95, and P99 percentiles. TTFT measures how quickly the model starts generating output - critical for streaming user experience.",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "s", "noValue": "No Data - Generate traffic first"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 92},
          "id": 36,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "histogram_quantile(0.5, sum(rate(vllm:time_to_first_token_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P50", "refId": "A"}, {"expr": "histogram_quantile(0.95, sum(rate(vllm:time_to_first_token_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P95", "refId": "B"}, {"expr": "histogram_quantile(0.99, sum(rate(vllm:time_to_first_token_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P99", "refId": "C"}],
          "title": "‚ö° Time to First Token (TTFT)",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "Inter-Token Latency (ITL) over time. Shows P50, P95, and P99 percentiles. ITL measures the time between consecutive output tokens - affects perceived 'typing speed' during streaming.",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "s", "noValue": "No Data - Generate traffic first"}, "overrides": []},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 92},
          "id": 37,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "histogram_quantile(0.5, sum(rate(vllm:inter_token_latency_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P50", "refId": "A"}, {"expr": "histogram_quantile(0.95, sum(rate(vllm:inter_token_latency_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P95", "refId": "B"}, {"expr": "histogram_quantile(0.99, sum(rate(vllm:inter_token_latency_seconds_bucket{model_name=~\"$model\"}[5m])) by (le, model_name))", "legendFormat": "{{model_name}} P99", "refId": "C"}],
          "title": "‚ö° Inter-Token Latency (ITL)",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {"h": 1, "w": 24, "x": 0, "y": 100},
          "id": 103,
          "panels": [],
          "title": "üèÜ Top Users",
          "type": "row"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": [{"matcher": {"id": "byName", "options": "user"}, "properties": [{"id": "displayName", "value": "üë§ User"}]}, {"matcher": {"id": "byName", "options": "Value"}, "properties": [{"id": "displayName", "value": "üìä Hits"}]}]},
          "gridPos": {"h": 7, "w": 24, "x": 0, "y": 101},
          "id": 34,
          "options": {"cellHeight": "sm", "footer": {"countRows": false, "fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "üìä Hits"}]},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "topk(10, sum by (user) (authorized_hits{user!=\"\"}))", "format": "table", "instant": true, "refId": "A"}],
          "description": "Top 10 users ranked by total tokens consumed. Helps identify your highest-consuming users.",
          "title": "üèÜ Top 10 Users by Token Usage",
          "type": "table"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": [{"matcher": {"id": "byName", "options": "user"}, "properties": [{"id": "displayName", "value": "üë§ User"}]}, {"matcher": {"id": "byName", "options": "Value"}, "properties": [{"id": "displayName", "value": "üìä Declined Requests"}]}]},
          "gridPos": {"h": 7, "w": 24, "x": 0, "y": 108},
          "id": 35,
          "options": {"cellHeight": "sm", "footer": {"countRows": false, "fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "üìä Declined Requests"}]},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "topk(10, sum by (user) (limited_calls{user!=\"\"}))", "format": "table", "instant": true, "refId": "A"}],
          "description": "Top 10 users ranked by rate-limited requests (HTTP 429). High counts may indicate users need a higher tier or are experiencing quota issues.",
          "title": "üèÜ Top 10 Users by Declined Requests",
          "type": "table"
        },
        {
          "collapsed": false,
          "gridPos": {"h": 1, "w": 24, "x": 0, "y": 115},
          "id": 104,
          "panels": [],
          "title": "üìã Detailed Breakdown",
          "type": "row"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}, "overrides": []},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 116},
          "id": 8,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (user) (rate(authorized_hits[5m]))", "legendFormat": "{{user}}", "refId": "A"}],
          "description": "Token consumption rate (tokens/s) broken down by individual user. Shows usage patterns over time.",
          "title": "üë• Token Rate by User",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"custom": {"align": "auto", "cellOptions": {"type": "auto"}, "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": [{"matcher": {"id": "byName", "options": "user"}, "properties": [{"id": "displayName", "value": "üë§ User"}]}, {"matcher": {"id": "byName", "options": "model"}, "properties": [{"id": "displayName", "value": "ü§ñ Model"}]}, {"matcher": {"id": "byName", "options": "tier"}, "properties": [{"id": "displayName", "value": "üè∑Ô∏è Tier"}]}, {"matcher": {"id": "byName", "options": "Value"}, "properties": [{"id": "displayName", "value": "üìä Requests"}]}]},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 124},
          "id": 9,
          "options": {"cellHeight": "sm", "footer": {"countRows": false, "fields": "", "reducer": ["sum"], "show": true}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "üìä Requests"}]},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (user, tier) (authorized_calls{user!=\"\"})", "format": "table", "instant": true, "refId": "A"}],
          "description": "Request count by user and tier. Excludes anonymous/internal requests (no user label). The model label is not available on authorized_calls; use authorized_hits for per-model token breakdown.",
          "title": "üìã Request Volume by User & Tier",
          "type": "table"
        },
        {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 132}, "id": 107, "panels": [], "title": "üì¶ Resource Allocation", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "fieldConfig": {"defaults": {"custom": {"align": "auto", "cellOptions": {"type": "auto"}, "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": [{"matcher": {"id": "byName", "options": "pod"}, "properties": [{"id": "displayName", "value": "ü§ñ Model Pod"}]}, {"matcher": {"id": "byName", "options": "CPU Requests"}, "properties": [{"id": "unit", "value": "short"}, {"id": "custom.width", "value": 120}]}, {"matcher": {"id": "byName", "options": "CPU Limits"}, "properties": [{"id": "unit", "value": "short"}, {"id": "custom.width", "value": 120}]}, {"matcher": {"id": "byName", "options": "Memory Requests"}, "properties": [{"id": "unit", "value": "bytes"}, {"id": "custom.width", "value": 150}]}, {"matcher": {"id": "byName", "options": "Memory Limits"}, "properties": [{"id": "unit", "value": "bytes"}, {"id": "custom.width", "value": 150}]}, {"matcher": {"id": "byName", "options": "GPUs"}, "properties": [{"id": "unit", "value": "short"}, {"id": "custom.width", "value": 80}]}]},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 133},
          "id": 29,
          "options": {"cellHeight": "sm", "footer": {"countRows": false, "fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Memory Requests"}]},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "max by (pod) (kube_pod_container_resource_requests{namespace=~\"$llm_namespace\", resource=\"cpu\"})", "format": "table", "instant": true, "refId": "A"}, {"expr": "max by (pod) (kube_pod_container_resource_limits{namespace=~\"$llm_namespace\", resource=\"cpu\"})", "format": "table", "instant": true, "refId": "B"}, {"expr": "max by (pod) (kube_pod_container_resource_requests{namespace=~\"$llm_namespace\", resource=\"memory\"})", "format": "table", "instant": true, "refId": "C"}, {"expr": "max by (pod) (kube_pod_container_resource_limits{namespace=~\"$llm_namespace\", resource=\"memory\"})", "format": "table", "instant": true, "refId": "D"}, {"expr": "max by (pod) (kube_pod_container_resource_requests{namespace=~\"$llm_namespace\", resource=~\"nvidia.com/gpu|amd.com/gpu\"})", "format": "table", "instant": true, "refId": "E"}],
          "title": "üì¶ Resource Allocation per Model",
          "description": "Resource requests/limits for LLM model pods. GPU column shows requested GPUs (nvidia.com/gpu or amd.com/gpu). For GPU utilization metrics, DCGM Exporter must be installed. See 'GPU Cache Usage' panel above for vLLM's KV-cache utilization.",
          "type": "table",
          "transformations": [{"id": "joinByField", "options": {"byField": "pod", "mode": "outer"}}, {"id": "organize", "options": {"excludeByName": {"Time": true, "Time 1": true, "Time 2": true, "Time 3": true, "Time 4": true, "Time 5": true}, "renameByName": {"Value #A": "CPU Requests", "Value #B": "CPU Limits", "Value #C": "Memory Requests", "Value #D": "Memory Limits", "Value #E": "GPUs"}}}]
        },
        {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 141}, "id": 109, "panels": [], "title": "üë§ User Tracking", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "Per-user metrics. Shows token consumption rate (authorized_hits) vs rate-limited requests (HTTP 429) per user over time.",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"tooltip": false, "viz": false, "legend": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ops"}, "overrides": []},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 142},
          "id": 30,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (user) (rate(authorized_hits[5m]))", "legendFormat": "{{user}} (tokens/s)", "refId": "A"}, {"expr": "sum by (user) (rate(limited_calls[5m]))", "legendFormat": "{{user}} (429 Rate Limited)", "refId": "B"}],
          "title": "üë§ Token Usage & Rate Limits per User",
          "type": "timeseries"
        },
        {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 150}, "id": 108, "panels": [], "title": "üìä Per-Tier & Per-Model Breakdown", "type": "row"},
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "P50 / P95 / P99 latency per access tier.\n\nThe tier label is added via Istio Telemetry reading the X-MaaS-Tier header injected by AuthPolicy.\nPer-user latency is not on the histogram to keep cardinality bounded.",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ms"}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 0, "y": 151},
          "id": 31,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "histogram_quantile(0.5, sum by (tier, le) (rate(istio_request_duration_milliseconds_bucket{tier!=\"\",tier!=\"unknown\"}[5m])))", "legendFormat": "{{tier}} P50", "refId": "A"}, {"expr": "histogram_quantile(0.95, sum by (tier, le) (rate(istio_request_duration_milliseconds_bucket{tier!=\"\",tier!=\"unknown\"}[5m])))", "legendFormat": "{{tier}} P95", "refId": "B"}, {"expr": "histogram_quantile(0.99, sum by (tier, le) (rate(istio_request_duration_milliseconds_bucket{tier!=\"\",tier!=\"unknown\"}[5m])))", "legendFormat": "{{tier}} P99", "refId": "C"}],
          "title": "‚è±Ô∏è Latency per Tier (P50 / P95 / P99)",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "P95 latency per model (backend service).\n\nEach KServe model gets a dedicated service, so destination_service_name maps directly to the model. Shows how each model's response time compares.",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "ms"}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 8, "y": 151},
          "id": 32,
          "options": {"legend": {"calcs": ["lastNotNull", "mean"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "histogram_quantile(0.95, sum by (destination_service_name, le) (rate(istio_request_duration_milliseconds_bucket{destination_service_name!=\"\",destination_service_name!=\"unknown\"}[5m])))", "legendFormat": "{{destination_service_name}}", "refId": "A"}],
          "title": "‚è±Ô∏è P95 Latency per Model",
          "type": "timeseries"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${datasource}"},
          "description": "Token consumption per tier over time (stacked).\n\nShows absolute token volume per tier as stacked bars. The height of each bar is the total tokens consumed in that interval; the stacking shows the tier proportion.\n\nFor per-user billing, use the AI Engineer dashboard or query Prometheus:\n  sum by (user) (increase(authorized_hits[24h]))",
          "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisBorderShow": false, "axisCenteredZero": false, "axisColorMode": "text", "axisLabel": "tokens", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "bars", "fillOpacity": 80, "gradientMode": "hue", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "insertNulls": false, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "normal"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}, "overrides": []},
          "gridPos": {"h": 8, "w": 8, "x": 16, "y": 151},
          "id": 33,
          "options": {"legend": {"calcs": ["sum"], "displayMode": "table", "placement": "bottom", "showLegend": true}, "tooltip": {"mode": "multi", "sort": "desc"}},
          "pluginVersion": "11.3.0",
          "targets": [{"expr": "sum by (tier) (increase(authorized_hits{tier!=\"\"}[5m]))", "legendFormat": "{{tier}}", "refId": "A"}],
          "title": "üìä Token Volume by Tier",
          "type": "timeseries"
        }
      ],
      "refresh": "30s",
      "schemaVersion": 40,
      "tags": ["maas", "platform-admin", "observability"],
      "templating": {
        "list": [
          {"current": {"selected": true, "text": "prometheus", "value": "prometheus"}, "hide": 0, "includeAll": false, "label": "Datasource", "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "type": "datasource"},
          {"current": {"selected": false, "text": "maas-api", "value": "maas-api"}, "datasource": {"type": "prometheus", "uid": "${datasource}"}, "definition": "label_values(kube_pod_info{pod=~\"maas-api.*\"}, namespace)", "description": "Auto-detected namespace where MaaS API is deployed", "hide": 0, "includeAll": false, "label": "MaaS Namespace", "multi": false, "name": "maas_namespace", "options": [], "query": {"qryType": 1, "query": "label_values(kube_pod_info{pod=~\"maas-api.*\"}, namespace)", "refId": "PrometheusVariableQueryEditor-VariableQuery"}, "refresh": 2, "regex": "", "skipUrlSync": false, "sort": 1, "type": "query"},
          {"current": {"selected": false, "text": "kuadrant-system", "value": "kuadrant-system"}, "description": "Namespace where Kuadrant (Authorino, Limitador) is deployed", "hide": 0, "label": "Kuadrant Namespace", "name": "kuadrant_namespace", "options": [{"selected": true, "text": "kuadrant-system", "value": "kuadrant-system"}], "query": "kuadrant-system", "skipUrlSync": false, "type": "textbox"},
          {"current": {"selected": false, "text": "openshift-ingress", "value": "openshift-ingress"}, "description": "Namespace where the Istio/Gateway pods run", "hide": 0, "label": "Gateway Namespace", "name": "gateway_namespace", "options": [{"selected": true, "text": "openshift-ingress", "value": "openshift-ingress"}], "query": "openshift-ingress", "skipUrlSync": false, "type": "textbox"},
          {"current": {"selected": false, "text": "llm", "value": "llm"}, "description": "Namespace where LLM model pods are deployed", "hide": 0, "label": "LLM Namespace", "name": "llm_namespace", "options": [{"selected": true, "text": "llm", "value": "llm"}], "query": "llm", "skipUrlSync": false, "type": "textbox"},
          {"current": {"selected": true, "text": "All", "value": "$__all"}, "datasource": {"type": "prometheus", "uid": "${datasource}"}, "definition": "label_values(vllm:num_requests_running, model_name)", "description": "Filter by model", "hide": 0, "includeAll": true, "allValue": ".*", "label": "Model", "multi": true, "name": "model", "options": [], "query": {"qryType": 1, "query": "label_values(vllm:num_requests_running, model_name)", "refId": "PrometheusVariableQueryEditor-VariableQuery"}, "refresh": 2, "regex": "", "skipUrlSync": false, "sort": 1, "type": "query"}
        ]
      },
      "time": {"from": "now-1h", "to": "now"},
      "timepicker": {},
      "timezone": "",
      "title": "üî∑ Platform Admin Dashboard",
      "uid": "platform-admin",
      "version": 1,
      "weekStart": ""
    }

